{
    "survey": {
        "id": {{ survey.id }},
        "title": "{{ survey.title|escapejs }}",
        "shortname": "{{ survey.shortname|escapejs }}",
        "version": "{{ survey.version|escapejs }}",
        "created": "{{ survey.created }}",
        "updated": "{{ survey.updated }}",
        "questions": [
            {% for question in survey.question_set.all %}
            {
                "id": {{ question.id }},
                "title": "{{ question.title|default:''|escapejs }}",
                "shortname": "{{ question.shortname|default:''|escapejs }}",
                "data_name": "{{ question.data_name|default:''|escapejs }}",
                "description": "{{ question.description|default:''|escapejs }}",
                "type": "{{ question.type }}",
                "data_type": "{{ question.data_type.js_class }}",
                "starts_hidden": {% if question.starts_hidden %} true {% else %} false {% endif %},
                "is_mandatory": {% if question.is_mandatory %} true {% else %} false {% endif %},
                "tags": "{{ question.tags|default:''|escapejs }}",
                "regex": "{{ question.regex|default:''|escapejs }}",
                "error_message": "{{ question.error_message|default:''|escapejs }}",
                "options": [
                    {% for option in question.option_set.all %}
                    {
                        "id": {{ option.id }},
                        "text": "{{ option.text|escapejs }}",
                        "value": "{{ option.value|escapejs }}",
                        "starts_hidden": {% if option.starts_hidden %} true {% else %} false {% endif %},
                        "virtual_type": "{{ option.virtual_type.js_class }}",
                        "virtual_inf": "{{ option.virtual_inf|escapejs }}",
                        "virtual_sup": "{{ option.virtual_sup|escapejs }}",
                        "virtual_regex": "{{ option.virtual_regex }}"
                    }{% if not forloop.last %},{% endif%}
                    {% endfor %}
                ]
            }{% if not forloop.last %},{% endif%}
            {% endfor %}
        ],
        "derived_values": [
            {% for question in survey.question_set.all %}
            {% if question.is_text %}
            {% for option in question.option_set.all %}
            {
                "id": {{ option.id }},
                "question": {{ question.id }},
                "virtual_type": {{option.virtual_type.js_class}},
                "virtual_inf": "{{ option.virtual_inf|default:''|escapejs }}",
                "virtual_sup": "{{ option.virtual_sup|default:''|escapejs }}",
                "virtual_regex": "{{ option.virtual_regex|default:''|escapejs }}"
            }{% if not forloop.last %},{% endif%}
            {% endfor %}
            {% endif %}
            {% endfor %}
        ],
        "rules": [
            {% for question in survey.question_set.all %}
            {% for rule in question.subject_of_rules.all %}
            {
                "id": {{ rule.id }},
                "subject_question": {{ question.id }},
                "type": "{{rule.js_class}}",
                "subject_option": {{rule.subject_option.id}},
                "object_question": {{rule.object_question.id}},
                "object_options":
                     [ {% for option in rule.object_options.all %}
                        {{ option.id }}{% if not forloop.last %},{% endif%}
                     {% endfor %} ]
            }{% if not forloop.last %},{% endif%}
            {% endfor %}
            {% endfor %}
        ]
    }
}
